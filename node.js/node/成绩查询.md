# 成绩查询

![image-20220501120407118](D:\users\admin\Desktop\学习笔记\node.js\img\17.png)





![image-20220501120711020](D:\users\admin\Desktop\学习笔记\node.js\img\18.png)





![image-20220501120951662](D:\users\admin\Desktop\学习笔记\node.js\img\19.png)



### node

```javascript
const fs = require('fs');
const path = require('path');
const url = require('url');
const http = require('http');
const template = require('art-template');

var people = [{
    name: 'ww',
    score: 100
}, {
    name: 'wl',
    score: 100
}, {
    name: 'wq',
    score: 100
}];
var com = null;

http
    .createServer((req, res) => {

        var parseObj = url.parse(req.url, true);
        var pathname = parseObj.pathname; //直接获得真正的url地址

        if (pathname === '/') {
            // console.log(__dirname);  绝对路径：D:\users\admin\Desktop\前端\学习2\nodeJs
            fs.readFile('./html/成绩查询.html', (err, data) => {
                if (err) return res.end('404 || 没有找到页面');

                var htmlStr = template.render(data.toString(), {
                    people: people,
                    name: com,
                })
                res.end(htmlStr);
            })
        } else if (pathname.indexOf('/public/') === 0) {
            fs.readFile('.' + pathname, (err, data) => {
                if (err) {
                    return res.end('404 Not Found');
                }
                res.end(data);
            })
        } else if (pathname == '/getScore') {
            console.log('获得前端返回的数据了');
            com = parseObj.query.name;
            console.log(com);

            // 页面重定向
            res.statusCode = 302;
            res.setHeader('Location', '/'); //url根路径
            //不需要响应数据  即不需要res.end();
            res.end('请求成功')

        } else {
            fs.readFile('./404/index.html', (err, data) => {
                if (err) {
                    return res.end('404 Not Found');
                }
                res.end(data);
            })
        }
    })
    .listen(3000, (err) => {
        if (err) console.log('开启端口错误');
        console.log('listening on ...')
    })
```

### html

```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="/public/js/jquery-1.11.0.min.js"></script>
    <script src="/public/js/jquery.js"></script>
    <style>
        #value {
            width: 200px;
            padding: 10px;
            background-color: antiquewhite;
            /* display: none; */
        }
    </style>
    <script>
        $(function() {
            $('#submit').on('click', () => {
                var name = $('#name').val();
                $.ajax({
                    type: 'get',
                    // 跨域不能成功：localhost不能跨域到tom
                    url: '/getScore',
                    data: {
                        name: name
                    },
                    success: function(data) {

                        // 用来刷新页面的location.assign()或者reload()，页面之后所有操作都会消失

                        new Promise(function(resolve, reject) {
                            location.reload();
                            resolve();
                        }).then(function() {
                            setTimeout(function() {
                                alert('a')
                                $('#name').val('name');
                            }, 1000);
                        })

                    },
                    error: function() {
                        console.log('falure');
                    }
                })
            })
        })
    </script>
</head>

<body>
    <div>
        <input type="text" id="name" />
        <input type="button" value="查询" id="submit" />

        <div id="value">
            {{each people}}
            <ul>
                {{if $value.name == name}}
                <li>{{$value.name}}</li>
                <li>{{$value.score}}</li>
                {{/if}}
            </ul>
            {{/each}}
        </div>
    </div>

</body>

</html>
```

